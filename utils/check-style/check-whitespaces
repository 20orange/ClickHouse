#!/usr/bin/env bash

ROOT_PATH=$(git rev-parse --show-toplevel)
EXCLUDE_DIRS='build/|integration/|widechar_width/|glibc-compatibility/|memcpy/|consistent-hashing/|Parsers/New'

if [ -z "$1" ]; then
    DIR=$(readlink -f $(dirname $0))
    . "$DIR/functions.sh"
    FILES=$(get_files_to_check)
else
    FILES="$1"
fi

FILES=$(echo "$FILES" | grep -vP $EXCLUDE_DIRS)
CPP_H_FILES=$(echo "$FILES" | grep -E "*(\.h|\.cpp)$")

# Double whitespaces
[ -n "$CPP_H_FILES" ] && echo "$CPP_H_FILES" |
    while read i; do $ROOT_PATH/utils/check-style/double-whitespaces.pl < "$ROOT_PATH/$i" || echo -e "^ File $i contains double whitespaces\n"; done
